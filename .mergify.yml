pull_request_rules:
  # auto label ceph PR based on title content
  - name: auto ceph label pr storage backend
    conditions:
      - title~=^ceph
      - base=master
    actions:
      label:
        add:
          - ceph
  # if there is a conflict in a backport PR, ping the author to send a proper backport PR
  - name: ping author on conflicts
    conditions:
      - conflict
    actions:
      comment:
        message: This pull request has merge conflicts that must be resolved before it can be merged. @{{author}} please rebase it. https://rook.io/docs/rook/master/development-flow.html#updating-your-fork
  # automerge backports if CI successfully ran
  # release-1.2 branch
  - name: automerge backport release-1.2
    conditions:
      - author=mergify[bot]
      - base=release-1.2
      - label!=do-not-merge
      - 'status-success=DCO'
      - 'status-success=continuous-integration/jenkins/pr-head'
    actions:
      merge:
        method: merge
        strict: false
      dismiss_reviews: {}
      delete_head_branch: {}
  # release-1.3 branch
  - name: automerge backport release-1.3
    conditions:
      - author=mergify[bot]
      - base=release-1.3
      - label!=do-not-merge
      - 'status-success=DCO'
      - 'status-success=continuous-integration/jenkins/pr-head'
    actions:
      merge:
        method: merge
        strict: false
      dismiss_reviews: {}
      delete_head_branch: {}
  # release-1.3 branch
  - name: automerge backport release-1.4
    conditions:
      - author=mergify[bot]
      - base=release-1.4
      - label!=do-not-merge
      - 'status-success=DCO'
      - 'status-success=continuous-integration/jenkins/pr-head'
    actions:
      merge:
        method: merge
        strict: false
      dismiss_reviews: {}
      delete_head_branch: {}
  # Trigger backport PRs based on label
  # release-1.2 branch
  - actions:
      backport:
        branches:
        - release-1.2
    conditions:
      - label=backport-release-1.2
    name: backport release-1.2
  # release-1.3 branch
  - actions:
      backport:
        branches:
        - release-1.3
    conditions:
      - label=backport-release-1.3
    name: backport release-1.3
  # release-1.4 branch
  - actions:
      backport:
        branches:
        - release-1.4
    conditions:
      - label=backport-release-1.4
    name: backport release-1.4
