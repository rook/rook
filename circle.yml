machine:
  environment:
    NPROCS: $(( ($(grep -c ^processor /proc/cpuinfo) + 1) / 2 ))
  services:
    - docker

dependencies:
  cache_directories:
    - ~/.ccache
  
  override:
    - docker info
    - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
    - docker pull quantum/castle-build
    - echo -e "machine github.com\n\tlogin quantumbuild\n\tpassword $GITHUB_TOKEN" > ~/.netrc
    - ./build/run-build.sh make -j$NPROCS build

test:
  override:
    - echo no tests
