# Operator settings that can be updated without an operator restart
# Operator settings that require an operator restart are found in the operator env vars
kind: ConfigMap
apiVersion: v1
metadata:
  name: rook-ceph-operator-config
  namespace: {{ .Release.Namespace }} # namespace:operator
data:
  ROOK_LOG_LEVEL: {{ .Values.logLevel | quote }}
  ROOK_CEPH_COMMANDS_TIMEOUT_SECONDS: {{ .Values.cephCommandsTimeoutSeconds | quote }}
  ROOK_OBC_WATCH_OPERATOR_NAMESPACE: {{ .Values.enableOBCWatchOperatorNamespace | quote }}
  {{- if .Values.operatorMetricsBindAddress }}
  ROOK_OPERATOR_METRICS_BIND_ADDRESS: {{ .Values.operatorMetricsBindAddress | quote }}
  {{- end }}
  {{- if .Values.obcProvisionerNamePrefix }}
  ROOK_OBC_PROVISIONER_NAME_PREFIX: {{ .Values.obcProvisionerNamePrefix | quote }}
  {{- end }}
  {{- if .Values.obcAllowAdditionalConfigFields }}
  ROOK_OBC_ALLOW_ADDITIONAL_CONFIG_FIELDS: {{ .Values.obcAllowAdditionalConfigFields | quote }}
  {{- end }}
  ROOK_CEPH_ALLOW_LOOP_DEVICES: {{ .Values.allowLoopDevices | quote }}
  ROOK_ENABLE_DISCOVERY_DAEMON: {{ .Values.enableDiscoveryDaemon | quote }}
  {{- if .Values.discoverDaemonUdev }}
  DISCOVER_DAEMON_UDEV_BLACKLIST: {{ .Values.discoverDaemonUdev | quote }}
  {{- end }}
  {{- if .Values.revisionHistoryLimit }}
  ROOK_REVISION_HISTORY_LIMIT: {{ .Values.revisionHistoryLimit | quote }}
  {{- end }}
  {{- if .Values.enforceHostNetwork }}
  ROOK_ENFORCE_HOST_NETWORK: {{ .Values.enforceHostNetwork | quote }}
  {{- end }}

  {{- with .Values.csi }}
  ROOK_USE_CSI_OPERATOR: {{ .rookUseCsiOperator | quote }}
  ROOK_CSI_ENABLE_RBD: {{ .enableRbdDriver | quote }}
  ROOK_CSI_ENABLE_CEPHFS: {{ .enableCephfsDriver | quote }}
  ROOK_CSI_DISABLE_DRIVER: {{ .disableCsiDriver | quote }}
  CSI_ENABLE_CEPHFS_SNAPSHOTTER: {{ .enableCephfsSnapshotter | quote }}
  CSI_ENABLE_NFS_SNAPSHOTTER: {{ .enableNFSSnapshotter | quote }}
  CSI_ENABLE_RBD_SNAPSHOTTER: {{ .enableRBDSnapshotter | quote }}
  CSI_PLUGIN_ENABLE_SELINUX_HOST_MOUNT: {{ .enablePluginSelinuxHostMount | quote }}
  CSI_ENABLE_ENCRYPTION: {{ .enableCSIEncryption | quote }}
  CSI_ENABLE_OMAP_GENERATOR: {{ .enableOMAPGenerator | quote }}
  CSI_ENABLE_HOST_NETWORK: {{ .enableCSIHostNetwork | quote }}
  CSI_ENABLE_METADATA: {{ .enableMetadata | quote }}
  CSI_ENABLE_VOLUME_GROUP_SNAPSHOT: {{ .enableVolumeGroupSnapshot | quote }}
  {{- if .csiDriverNamePrefix }}
  CSI_DRIVER_NAME_PREFIX: {{ .csiDriverNamePrefix | quote }}
  {{- end }}
  {{- if .pluginPriorityClassName }}
  CSI_PLUGIN_PRIORITY_CLASSNAME: {{ .pluginPriorityClassName | quote }}
  {{- end }}
  {{- if .provisionerPriorityClassName }}
  CSI_PROVISIONER_PRIORITY_CLASSNAME: {{ .provisionerPriorityClassName | quote }}
  {{- end }}
  {{- if .cephFSPluginUpdateStrategy }}
  CSI_CEPHFS_PLUGIN_UPDATE_STRATEGY: {{ .cephFSPluginUpdateStrategy | quote }}
  {{- end }}
  {{- if .cephFSPluginUpdateStrategyMaxUnavailable }}
  CSI_CEPHFS_PLUGIN_UPDATE_STRATEGY_MAX_UNAVAILABLE: {{ .cephFSPluginUpdateStrategyMaxUnavailable | quote }}
  {{- end }}
  {{- if .nfsPluginUpdateStrategy }}
  CSI_NFS_PLUGIN_UPDATE_STRATEGY: {{ .nfsPluginUpdateStrategy | quote }}
  {{- end }}
  {{- if .rbdFSGroupPolicy }}
  CSI_RBD_FSGROUPPOLICY: {{ .rbdFSGroupPolicy | quote }}
  {{- end }}
  {{- if .cephFSFSGroupPolicy }}
  CSI_CEPHFS_FSGROUPPOLICY: {{ .cephFSFSGroupPolicy | quote }}
  {{- end }}
  {{- if .nfsFSGroupPolicy }}
  CSI_NFS_FSGROUPPOLICY: {{ .nfsFSGroupPolicy | quote }}
  {{- end }}
  {{- if .rbdPluginUpdateStrategy }}
  CSI_RBD_PLUGIN_UPDATE_STRATEGY: {{ .rbdPluginUpdateStrategy | quote }}
  {{- end }}
  {{- if .cephFSKernelMountOptions }}
  CSI_CEPHFS_KERNEL_MOUNT_OPTIONS: {{ .cephFSKernelMountOptions | quote }}
  {{- end }}
  {{- if .rbdPluginUpdateStrategyMaxUnavailable }}
  CSI_RBD_PLUGIN_UPDATE_STRATEGY_MAX_UNAVAILABLE: {{ .rbdPluginUpdateStrategyMaxUnavailable | quote }}
  {{- end }}
  {{- if .kubeletDirPath }}
  ROOK_CSI_KUBELET_DIR_PATH: {{ .kubeletDirPath | quote }}
  {{- end }}
  {{- if .csiLeaderElectionLeaseDuration }}
  CSI_LEADER_ELECTION_LEASE_DURATION: {{ .csiLeaderElectionLeaseDuration | quote }}
  {{- end }}
  {{- if .csiLeaderElectionRenewDeadline }}
  CSI_LEADER_ELECTION_RENEW_DEADLINE: {{ .csiLeaderElectionRenewDeadline | quote }}
  {{- end }}
  {{- if .csiLeaderElectionRetryPeriod }}
  CSI_LEADER_ELECTION_RETRY_PERIOD: {{ .csiLeaderElectionRetryPeriod | quote }}
  {{- end }}
  {{- if .cephcsi }}
  {{- if and .cephcsi.repository .cephcsi.tag }}
  ROOK_CSI_CEPH_IMAGE: "{{ .cephcsi.repository }}:{{ .cephcsi.tag }}"
  {{- end }}
  {{- end }}
  {{- if .registrar }}
  {{- if and .registrar.repository .registrar.tag }}
  ROOK_CSI_REGISTRAR_IMAGE: "{{ .registrar.repository }}:{{ .registrar.tag }}"
  {{- end }}
  {{- end }}
  {{- if .provisioner }}
  {{- if and .provisioner.repository .provisioner.tag }}
  ROOK_CSI_PROVISIONER_IMAGE: "{{ .provisioner.repository }}:{{ .provisioner.tag }}"
  {{- end }}
  {{- end }}
  {{- if .snapshotter }}
  {{- if and .snapshotter.repository .snapshotter.tag }}
  ROOK_CSI_SNAPSHOTTER_IMAGE: "{{ .snapshotter.repository }}:{{ .snapshotter.tag }}"
  {{- end }}
  {{- end }}
  {{- if .attacher }}
  {{- if and .attacher.repository .attacher.tag }}
  ROOK_CSI_ATTACHER_IMAGE: "{{ .attacher.repository }}:{{ .attacher.tag }}"
  {{- end }}
  {{- end }}
  {{- if .resizer }}
  {{- if and .resizer.repository .resizer.tag }}
  ROOK_CSI_RESIZER_IMAGE: "{{ .resizer.repository }}:{{ .resizer.tag }}"
  {{- end }}
  {{- end }}
  {{- if .imagePullPolicy }}
  ROOK_CSI_IMAGE_PULL_POLICY: {{ .imagePullPolicy | quote }}
  {{- end }}
  {{- if .csiAddons }}
  CSI_ENABLE_CSIADDONS: {{ .csiAddons.enabled | quote }}
  {{- if and .csiAddons.repository .csiAddons.tag }}
  ROOK_CSIADDONS_IMAGE: "{{ .csiAddons.repository }}:{{ .csiAddons.tag }}"
  {{- end }}
  {{- end }}
  {{- if .crossNamespaceVolumeDataSource }}
  CSI_ENABLE_CROSS_NAMESPACE_VOLUME_DATA_SOURCE: {{ .crossNamespaceVolumeDataSource.enabled | quote }}
  {{- end }}
  {{- if .topology }}
  CSI_ENABLE_TOPOLOGY: {{ .topology.enabled | quote }}
  {{- if .topology.domainLabels }}
  CSI_TOPOLOGY_DOMAIN_LABELS: {{ .topology.domainLabels | join "," }}
  {{- end }}
  {{- end }}
  {{- if .nfs }}
  ROOK_CSI_ENABLE_NFS: {{ .nfs.enabled | quote }}
  {{- end }}
  {{- if .cephfsPodLabels }}
  ROOK_CSI_CEPHFS_POD_LABELS: {{ .cephfsPodLabels | quote }}
  {{- end }}
  {{- if .nfsPodLabels }}
  ROOK_CSI_NFS_POD_LABELS: {{ .nfsPodLabels | quote }}
  {{- end }}
  {{- if .rbdPodLabels }}
  ROOK_CSI_RBD_POD_LABELS: {{ .rbdPodLabels | quote }}
  {{- end }}
  {{- if .provisionerTolerations }}
  CSI_PROVISIONER_TOLERATIONS: {{ toYaml .provisionerTolerations | quote }}
  {{- end }}
  {{- if .provisionerNodeAffinity }}
  CSI_PROVISIONER_NODE_AFFINITY: {{ .provisionerNodeAffinity }}
  {{- end }}
  {{- if .rbdProvisionerTolerations }}
  CSI_RBD_PROVISIONER_TOLERATIONS: {{ toYaml .rbdProvisionerTolerations | quote }}
  {{- end }}
  {{- if .rbdProvisionerNodeAffinity }}
  CSI_RBD_PROVISIONER_NODE_AFFINITY: {{ .rbdProvisionerNodeAffinity }}
  {{- end }}
  {{- if .cephFSProvisionerTolerations }}
  CSI_CEPHFS_PROVISIONER_TOLERATIONS: {{ toYaml .cephFSProvisionerTolerations | quote }}
  {{- end }}
  {{- if .cephFSProvisionerNodeAffinity }}
  CSI_CEPHFS_PROVISIONER_NODE_AFFINITY: {{ .cephFSProvisionerNodeAffinity }}
  {{- end }}
  {{- if .nfsProvisionerTolerations }}
  CSI_NFS_PROVISIONER_TOLERATIONS: {{ toYaml .nfsProvisionerTolerations | quote }}
  {{- end }}
  {{- if .nfsProvisionerNodeAffinity }}
  CSI_NFS_PROVISIONER_NODE_AFFINITY: {{ .nfsProvisionerNodeAffinity }}
  {{- end }}
  {{- if .pluginTolerations }}
  CSI_PLUGIN_TOLERATIONS: {{ toYaml .pluginTolerations | quote }}
  {{- end }}
  {{- if .pluginNodeAffinity }}
  CSI_PLUGIN_NODE_AFFINITY: {{ .pluginNodeAffinity }}
  {{- end }}
  {{- if .rbdPluginTolerations }}
  CSI_RBD_PLUGIN_TOLERATIONS: {{ toYaml .rbdPluginTolerations | quote }}
  {{- end }}
  {{- if .rbdPluginNodeAffinity }}
  CSI_RBD_PLUGIN_NODE_AFFINITY: {{ .rbdPluginNodeAffinity }}
  {{- end }}
  {{- if .cephFSPluginTolerations }}
  CSI_CEPHFS_PLUGIN_TOLERATIONS: {{ toYaml .cephFSPluginTolerations | quote }}
  {{- end }}
  {{- if .cephFSPluginNodeAffinity }}
  CSI_CEPHFS_PLUGIN_NODE_AFFINITY: {{ .cephFSPluginNodeAffinity }}
  {{- end }}
  {{- if .nfsPluginTolerations }}
  CSI_NFS_PLUGIN_TOLERATIONS: {{ toYaml .nfsPluginTolerations | quote }}
  {{- end }}
  {{- if .nfsPluginNodeAffinity }}
  CSI_NFS_PLUGIN_NODE_AFFINITY: {{ .nfsPluginNodeAffinity }}
  {{- end }}
  {{- if .cephfsLivenessMetricsPort }}
  CSI_CEPHFS_LIVENESS_METRICS_PORT: {{ .cephfsLivenessMetricsPort | quote }}
  {{- end }}
  {{- if .enableLiveness }}
  CSI_ENABLE_LIVENESS: {{ .enableLiveness | quote }}
  {{- end }}
  {{- if .rbdLivenessMetricsPort }}
  CSI_RBD_LIVENESS_METRICS_PORT: {{ .rbdLivenessMetricsPort | quote }}
  {{- end }}
  {{- if .csiAddonsPort }}
  CSIADDONS_PORT: {{ .csiAddonsPort | quote }}
  {{- end }}
  {{- if .csiAddonsRBDProvisionerPort }}
  CSIADDONS_RBD_PROVISIONER_PORT: {{ .csiAddonsRBDProvisionerPort | quote }}
  {{- end }}
  {{- if .csiAddonsCephFSProvisionerPort }}
  CSIADDONS_CEPHFS_PROVISIONER_PORT: {{ .csiAddonsCephFSProvisionerPort | quote }}
  {{- end }}
  {{- if .forceCephFSKernelClient }}
  CSI_FORCE_CEPHFS_KERNEL_CLIENT: {{ .forceCephFSKernelClient | quote }}
  {{- end }}
  {{- if .logLevel }}
  CSI_LOG_LEVEL: {{ .logLevel | quote }}
  {{- end }}
  {{- if .sidecarLogLevel }}
  CSI_SIDECAR_LOG_LEVEL: {{ .sidecarLogLevel | quote }}
  {{- end }}
  {{- if .clusterName }}
  CSI_CLUSTER_NAME: {{ .clusterName | quote }}
  {{- end }}
  {{- if .grpcTimeoutInSeconds }}
  CSI_GRPC_TIMEOUT_SECONDS: {{ .grpcTimeoutInSeconds | quote }}
  {{- end }}
  {{- if .provisionerReplicas }}
  CSI_PROVISIONER_REPLICAS: {{ .provisionerReplicas | quote }}
  {{- end }}
  {{- if .csiRBDProvisionerResource }}
  CSI_RBD_PROVISIONER_RESOURCE: {{ .csiRBDProvisionerResource | quote }}
  {{- end }}
  {{- if .csiRBDPluginResource }}
  CSI_RBD_PLUGIN_RESOURCE: {{ .csiRBDPluginResource | quote }}
  {{- end }}
  {{- if .csiCephFSProvisionerResource }}
  CSI_CEPHFS_PROVISIONER_RESOURCE: {{ .csiCephFSProvisionerResource | quote }}
  {{- end }}
  {{- if .csiCephFSPluginResource }}
  CSI_CEPHFS_PLUGIN_RESOURCE: {{ .csiCephFSPluginResource | quote }}
  {{- end }}
  {{- if .csiNFSProvisionerResource }}
  CSI_NFS_PROVISIONER_RESOURCE: {{ .csiNFSProvisionerResource | quote }}
  {{- end }}
  {{- if .csiNFSPluginResource }}
  CSI_NFS_PLUGIN_RESOURCE: {{ .csiNFSPluginResource | quote }}
  {{- end }}
  {{- if .csiRBDPluginVolume }}
  CSI_RBD_PLUGIN_VOLUME: {{ toYaml .csiRBDPluginVolume | quote }}
  {{- end }}
  {{- if .csiRBDPluginVolumeMount }}
  CSI_RBD_PLUGIN_VOLUME_MOUNT: {{ toYaml .csiRBDPluginVolumeMount | quote }}
  {{- end }}
  {{- if .csiCephFSPluginVolume }}
  CSI_CEPHFS_PLUGIN_VOLUME: {{ toYaml .csiCephFSPluginVolume | quote }}
  {{- end }}
  {{- if .csiCephFSPluginVolumeMount }}
  CSI_CEPHFS_PLUGIN_VOLUME_MOUNT: {{ toYaml .csiCephFSPluginVolumeMount | quote }}
  {{- end }}
  CSI_CEPHFS_ATTACH_REQUIRED: {{ .cephFSAttachRequired | quote }}
  CSI_RBD_ATTACH_REQUIRED: {{ .rbdAttachRequired | quote }}
  CSI_NFS_ATTACH_REQUIRED: {{ .nfsAttachRequired | quote }}
  {{- if .kubeApiBurst }}
  CSI_KUBE_API_BURST: {{ .kubeApiBurst | quote }}
  {{- end }}
  {{- if .kubeApiQPS }}
  CSI_KUBE_API_QPS: {{ .kubeApiQPS | quote }}
  {{- end }}
  {{- end }}
